#!/bin/bash
{{ if and (eq .chezmoi.os "linux") (not .headless) }}
{{ $extensions := list
     "asvetliakov.vscode-neovim"
     "eamodio.gitlens"
     "EditorConfig.EditorConfig"
     "golang.go"
     "jinliming2.vscode-go-template"
     "ms-python.python"
     "ms-vscode-remote.remote-containers"
     "ms-vscode-remote.remote-ssh"
     "ms-vscode-remote.remote-ssh-edit"
     "ms-vscode-remote.remote-extensionpack"
     "ms-vscode.cpptools"
     "redhat.vscode-yaml"
     "stkb.rewrap"
     "tamasfe.even-better-toml"
     "Tyriar.sort-lines"
     "yzhang.markdown-all-in-one" }}

set -euo pipefail

# Check if code command is available
if ! command -v code >/dev/null 2>&1; then
    echo "VSCode is not installed or not in PATH, skipping extension installation"
    exit 0
fi

echo "Installing VSCode extensions..."
{{ range $extensions }}
echo "Checking extension: {{ . }}"
if ! code --list-extensions | grep -q "^{{ . }}$"; then
    echo "Installing extension: {{ . }}"
    code --force --install-extension {{ . }} || {
        echo "Warning: Failed to install extension {{ . }}"
        continue
    }
else
    echo "Extension {{ . }} is already installed"
fi
{{ end }}

echo "VSCode extension installation complete"
{{ end }}
